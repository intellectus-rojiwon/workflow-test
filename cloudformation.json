{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "The AWS CloudFormation template for this Lambda Function",
    "Resources": {
      "LambdaExecutionRole": {
        "Type": "AWS::IAM::Role",
        "Properties": {
          "AssumeRolePolicyDocument": {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "Service": "lambda.amazonaws.com"
                },
                "Action": "sts:AssumeRole"
              }
            ]
          },
          "Policies": [
            {
              "PolicyName": "AWSLambdaBasicExecutionRolePolicy",
              "PolicyDocument": {
                "Version": "2012-10-17",
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Action": "logs:CreateLogGroup",
                    "Resource": {
                      "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:*"
                    }
                  },
                  {
                    "Effect": "Allow",
                    "Action": [
                      "logs:CreateLogStream",
                      "logs:PutLogEvents"
                    ],
                    "Resource": {
                      "Fn::Sub": "arn:aws:logs:${AWS::Region}:${AWS::AccountId}:log-group:/aws/lambda/${LambdaFunctionName}:*"
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "LambdaFunction": {
        "Type": "AWS::Lambda::Function",
        "Properties": {
          "FunctionName": {
            "Ref": "LambdaFunctionName"
          },
          "Role": {
            "Fn::GetAtt": "LambdaExecutionRole.Arn"
          },
          "PackageType": "Image",
          "Code": {
            "ImageUri": {
              "Ref": "LambdaImageUri"
            }
          },
          "Architectures": [
            {
              "Ref": "LambdaArchitectures"
            }
          ],
          "MemorySize": {
            "Ref": "LambdaMemorySize"
          },
          "EphemeralStorage": {
            "Size": {
              "Ref": "LambdaEphemeralStorageSize"
            }
          },
          "Timeout": {
            "Ref": "LambdaTimeout"
          }
        }
      },
      "LambdaVersion": {
        "Type": "AWS::Lambda::Version",
        "DependsOn": "LambdaFunction",
        "DeletionPolicy": "Retain",
        "Properties": {
          "FunctionName": {
            "Ref": "LambdaFunctionName"
          },
          "CodeSha256": {
            "Ref": "LambdaVersionCode"
          }
        }
      },
      "LambdaVersionAlias": {
        "Type": "AWS::Lambda::Alias",
        "DependsOn": "LambdaFunction",
        "Condition": "LambdaVersionAliasing",
        "Properties": {
          "FunctionName": {
            "Ref": "LambdaFunctionName"
          },
          "FunctionVersion": {
            "Fn::GetAtt": "LambdaVersion.Version"
          },
          "Name": "provisioned",
          "ProvisionedConcurrencyConfig": {
            "ProvisionedConcurrentExecutions": {
              "Ref": "ProvisionedConcurrency"
            }
          }
        }
      },
      "LambdaFunctionUrl": {
        "Type": "AWS::Lambda::Url",
        "DependsOn": "LambdaFunction",
        "Properties": {
          "AuthType": "NONE",
          "TargetFunctionArn": {
            "Fn::GetAtt": "LambdaFunction.Arn"
          }
        }
      }
    },
    "Conditions": {
      "LambdaVersionAliasing": {
        "Fn:Not": [
          {
            "Fn:Equals": [
              {
                "Ref": "ProvisionedConcurrency"
              },
              0
            ]
          }
        ]
      }
    },
    "Parameters": {
      "LambdaFunctionName": {
        "Type": "String",
        "Description": "Name of the Lambda function"
      },
      "LambdaImageUri": {
        "Type": "String",
        "Description": "URI of the Docker image for the Lambda function"
      },
      "LambdaArchitectures": {
        "Type": "String",
        "Description": "Architectures for the Lambda function (e.g., x86_64)"
      },
      "LambdaMemorySize": {
        "Type": "Number",
        "Description": "Memory size for the Lambda function (in MB)",
        "Default": 1024
      },
      "LambdaEphemeralStorageSize": {
        "Type": "Number",
        "Description": "Ephemeral storage size for the Lambda function (in MB)",
        "Default": 512
      },
      "LambdaTimeout": {
        "Type": "Number",
        "Description": "Timeout for the Lambda function (in seconds)",
        "Default": 6
      },
      "LambdaVersionCode": {
        "Type": "String",
        "Description": "Sha256 Code for Lambda Version Match"
      },
      "ProvisionedConcurrency": {
        "Type": "Number",
        "Description": "Provisioned concurrency for the Lambda function",
        "Default": 0
      }
    },
    "Outputs": {
      "LambdaFunctionUrl": {
        "Description": "URL of the deployed Lambda function",
        "Value": {
          "Fn::GetAtt": "LambdaFunctionUrl.FunctionUrl"
        }
      }
    }
  }
  