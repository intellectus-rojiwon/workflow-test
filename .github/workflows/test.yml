name: Test 🐳

on:
  workflow_dispatch:

permissions:
  id-token: write

jobs:
  build_and_push:
    runs-on: ubuntu-latest
    outputs:
      image_uri: ${{ steps.image.outputs.uri }}

    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@main

      - name: Configure AWS credentials 🔑
        uses: aws-actions/configure-aws-credentials@main
        with:
          role-to-assume: ${{ secrets.ROLE_TO_ASSUME }}
          aws-region: ${{ secrets.AWS_REGION }}

      - name: Login to Amazon ECR 🔑
        id: ecr
        uses: aws-actions/amazon-ecr-login@main

      - name: Init ECR Repository
        id: image
        run: |
          echo "::notice title=ECR Regsitry::${{ steps.ecr.outputs.registry }}"
          echo "::notice title=ROLE_NAME::$(echo ${{ secrets.ROLE_TO_ASSUME }} | cut -d '/' -f 2-)"
